@model Shop.Infrastructure.Models.PagedResult<Shop.Common.ViewModels.UserEditView>
@using PVT.Q1._2017.Shop.Helpers
@using Shop.Common.Models

@{
    ViewBag.Title = "UsersEdit";
}

<h2>UsersEdit</h2>

<div class="ui-widget">
    <label for="lastName">Last Name Search: </label>
    <input id="lastName">
</div>
Sort by: @Html.ActionLink("LastName", "UsersEdit", new { controller = "Manage", area = "User", id = ViewBag.PageInfo.PageNumber, sort = "LastName"}) |
@Html.ActionLink("FirstName", "UsersEdit", new { controller = "Manage", area = "User", id = ViewBag.PageInfo.PageNumber, sort = "FirstName" }) |
@Html.ActionLink("Login", "UsersEdit", new { controller = "Manage", area = "User", id = ViewBag.PageInfo.PageNumber, sort = "Login" }) |
@Html.ActionLink("Email", "UsersEdit", new { controller = "Manage", area = "User", id = ViewBag.PageInfo.PageNumber, sort = "Email" })

@Html.Partial("_UsersEdit", Model.Items)

@Html.PageLinks(Model, i => Url.Action("UsersEdit", new { id = i, controller = "Manage", area = "User" }))

@section scripts
{
    <script>
        $(function () {
            $("#lastName").autocomplete(
                {
                    minLength: 2,
                    source: function (request, response) {
                        $.ajax(
                            {
                                url: "@Url.Action("GetLastNameMatchingData",new { controller = "Manage", area = "User"})",
                                type: "POST",
                                data: {
                                    term: request.term
                                },
                                success: function (data) {
                                    response($.map(data, function (item) {
                                        return {
                                            label: item.LastName + " "+ item.FirstName,
                                            value: item.LastName,
                                            Id: item.Id
                                        }
                                    })
                                    );
                                }

                            });
                    },
                    select: function (event, ui) {
                        var link = '@Url.Action("Edit", "Manage", new { area = "User", Id = "id_holder" }, Request.Url.Scheme)';
                        document.location.href = link.replace("id_holder", ui.item.Id);
                        return false;
                    }
                });
        });
    </script>
}


@section cssStyles
{
    <link href="~/Content/themes/base/autocomplete.css" rel="stylesheet" />
    <link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
}