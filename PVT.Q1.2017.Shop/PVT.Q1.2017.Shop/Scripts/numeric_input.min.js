function addTriads(a){if(!a)return"";for(var b=a=""+a;;){a=a.replace(/(\d+)(\d{3})/g,"$1 $2");if(a===b)break;b=a}return a}function removeTriads(a){var b=/((((^-?\d+)|(\d+))[^\d\.,]?)+)([\.,]\d+)?/g.exec(a);return b?(a=b[1],b=b[6],a=a.replace(/(((^-?\d+)|(\d+))(\D+)*)/g,"$2"),b?a+b:a):a}function convertToNumber(a,b){if(!a)return 0;b||(b=".");(a=(""+a).replace(/[^\-\d\,\.]/g,"").replace(/\b(\d+)([\.\,]\d+)?(.*)/g,"$1$2").replace(/[\.\,]/g,b))&&"-"!==a||(a=0);return a}
function setNumericTextboxMaxValue(a,b){b=void 0!==b?+convertToNumber(b):-1;a.data("maxValue",b)}function getNumericTextboxMaxValue(a){return+a.data("maxValue")}function setNumericTextboxMinValue(a,b){b=void 0!==b?+convertToNumber(b):0;a.data("minValue",b)}function getNumericTextboxMinValue(a){return+a.data("minValue")}function setNumericTextboxIsRequired(a,b){a.data("required",void 0!==b?!!b:!0)}function getNumericTextboxIsRequired(a){return!!a.data("required")}
function setNumericTextboxIsMoney(a,b){a.data("isMoney",void 0!==b?!!b:!1)}function getNumericTextboxIsMoney(a){return!!a.data("isMoney")}function setNumericTextboxShowTooltipSetting(a,b){a.data("showTooltip",void 0!==b?!!b:!0)}function getNumericTextboxShowTooltipSetting(a){return!!a.data("showTooltip")}
function convertToNumericTextbox(a,b){function h(a){if(!a)return"";/\d+\s+\d+/g.exec(a)&&(a=removeTriads(a));var b=p.exec(a);if(b){a=b[1];if(k&&(b=b[2])&&0<b.length){if(2>=b.length)for(;b.length<d+1;)b+="0";return addTriads(a)+b}return addTriads(a)}return a}function m(a,b){if(a.value){var c=p.exec(convertToNumber(a.value,q)),c=c?c[0]:"0";c!=a.value&&(a.value=c)}else b&&(a.value="0")}function r(a){return 48<=a.keyCode&&57>=a.keyCode||96<=a.keyCode&&105>=a.keyCode}if(a&&a.prop&&a.attr&&"INPUT"===a.prop("tagName")){"true"==
a.attr("data-converted-to-numeric")&&(a.off("focus"),a.off("keydown"),a.off("keypress"),a.off("keyup"),a.off("blur"));var k=b&&void 0!==b.allowFractional?!!b.allowFractional:!1,f=b&&void 0!==b.integerPartMaxLength?+b.integerPartMaxLength:28,n=b&&void 0!==b.acceptNegative?!!b.acceptNegative:!1,q=b&&void 0!==b.decimalSeparator?b.decimalSeparator:".",l=!(b&&27<=b.scriptVersion);b?(setNumericTextboxMaxValue(a,b.maxValue),setNumericTextboxMinValue(a,b.minValue),setNumericTextboxIsRequired(a,b.required),
setNumericTextboxIsMoney(a,b.isMoney),setNumericTextboxShowTooltipSetting(a,b.showTooltip)):(setNumericTextboxMaxValue(a),setNumericTextboxMinValue(a),setNumericTextboxIsRequired(a),setNumericTextboxIsMoney(a),setNumericTextboxShowTooltipSetting(a));a.hasClass("numeric-text-box")||a.addClass("numeric-text-box");var d=0,g=f,f=n?"^-?(\\d{1,"+f+"})":"^(\\d{1,"+f+"})";k&&(d=b&&void 0!==b.fractionalPartMaxLength?+b.fractionalPartMaxLength:9,0<d&&(f=f+"(([\\.\\,]\\d{1,"+d+"})?)",g=g+d+1));var p=new RegExp(f);
n?a.attr("maxLength",g+1):a.attr("maxLength",g);g=getNumericTextboxIsRequired(a);l||m(a.get(0),g);g&&!a.val()&&a.val(0);l=h(a.val());getNumericTextboxShowTooltipSetting(a)&&(a.get(0).title=l,a.tooltip({position:{my:"left top+5",at:"left bottom"}}),a.tooltip("option","content",l));getNumericTextboxIsMoney(a)&&(a.val(l),a.hasClass("numeric-text-box-money")||a.addClass("numeric-text-box-money"));a.focus(function(){this.value=removeTriads(this.value);this.select();getNumericTextboxShowTooltipSetting($(this))&&
((this.title=h(this.value))?$(this).tooltip("option","content",this.title).tooltip("open"):$(this).tooltip("close"))});a.keydown(function(a){if(190===a.keyCode||191===a.keyCode||188===a.keyCode||110===a.keyCode)return!0;var b;(b=r(a)||13===a.keyCode||27===a.keyCode||8===a.keyCode||9===a.keyCode||36===a.keyCode||35===a.keyCode||46===a.keyCode)||(b=37===a.keyCode||39===a.keyCode);return b||67===a.keyCode&&a.ctrlKey||86===a.keyCode&&a.ctrlKey||88===a.keyCode&&a.ctrlKey||65===a.keyCode&&a.ctrlKey||112<=
a.keyCode&&123>=a.keyCode||n&&109===a.keyCode&&189===a.keyCode});a.keypress(function(a){if(!r(a)&&0!==a.charCode){a=String.fromCharCode(a.keyCode);if("."===a||","===a){if(a=k)a=this.value,a=!(0<=a.indexOf(",")||0<=a.indexOf("."));if(a)return!0}return!1}return!0});a.keyup(function(a){if(0<this.value.length){if(0===this.value.indexOf(",")||0===this.value.indexOf("."))this.value="0"+this.value;var b=this.value.length-1,c=this.value.indexOf("."),e=this.value.indexOf(",");(0<=c||0<=e)&&c!==b&&e!==b&&(b=
k&&(d+c===b||d+e===b),k&&b||(b=getNumericTextboxIsRequired($(this)),m(this,b)))}getNumericTextboxShowTooltipSetting($(this))&&((this.title=h(this.value))&&13!==a.keyCode?$(this).tooltip("option","content",this.title).tooltip("open"):$(this).tooltip("close"))});a.blur(function(){var a=$(this),b=getNumericTextboxIsRequired(a);if(!b&&0===a.val().length)return!0;var c=a.val().indexOf("."),e=a.val().indexOf(","),d=a.val().length-1;c===d||e===d?a.val(a.val().slice(0,-1)):0!==c&&0!==e||a.val("0"+a.val());
m(this,b);b=getNumericTextboxMaxValue(a);c=getNumericTextboxMinValue(a);e=convertToNumber(a.val(),q);-1!==b&&void 0!==b&&b<e&&(a.val(b),e=b);void 0!==c&&c>e&&a.val(c);getNumericTextboxIsMoney(a)&&a.val(h(a.val()));getNumericTextboxShowTooltipSetting($(this))&&(this.title=h(a.val()),$(this).tooltip("option","content",this.title).tooltip("close"))});a.attr("data-converted-to-numeric","true")}};
